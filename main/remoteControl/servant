local tEvents = {}

local function onExit()
	for i, n in ipairs(tEvents) do
		os.queueEvent(unpack(n, 1))
	end
end

local sCName = read()
local nID = rednet.lookup("remoteControl", sCName)
rednet.send(nID, "PADI")
while true do
	local e, p1, p2, p3, p4 = os.pullEvent()
	if e == "rednet_message" and p1 == nID then
		if p2 == "PADO" then
			break
		else
			onExit()
			return
		end
	else
		table.insert(tEvents, {e, p1, p2, p3, p4})
	end
end

while true do
	local e, p1, p2, p3, p4 = os.pullEventRaw()
	if e == "terminate" then
		break
	elseif e == "rednet_message" and p1 == nID then
		local ok, err = loadstring(p2)
		if ok then
			ok, err = pcall(ok)
			if not ok then
				printError(err)
			end
		end
	else
		table.insert(tEvents, {e, p1, p2, p3, p4})
	end
end

onExit()